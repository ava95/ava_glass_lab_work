stats_median_zscore <- setNames(filtered_analysis_df$Gene, filtered_analysis_df$mean_z_score)
stats_raw_zscore <- setNames(edge_df$z_score_combined, edge_df$edge)
gsea_results_raw_zscore <- fgsea(pathways_with_edges, stats_raw_zscore)
length(stats_raw_zscore)
length(pathways_with_edges)
View(pathways_with_edges)
fgsea
fgseaMultilevel
fgseaMultilevel
length(pathways_with_edges)
length(stats_raw_zscore)
?fgsea
gsea_results_raw_zscore <- fgsea(pathways_with_edges, stats_raw_zscore, nperm=100)
mat_mirna_goa <- read.csv("../data/mat_mirna_goa.csv")
edge_df <- read.csv("../data/all_merged_for_analysis.csv")
mat_mirna_goa$mirbase_id <- mat_mirna_goa$Gene_Name
# Preprocess mat_mirna_goa to match format of edge_df
mat_mirna_goa$mirbase_id <- substr(toupper(mat_mirna_goa$mirbase_id), 5, nchar(mat_mirna_goa$mirbase_id))
mat_mirna_goa$mirbase_id <- ifelse(
(endsWith(mat_mirna_goa$mirbase_id, "-3p")) | (endsWith(mat_mirna_goa$mirbase_id, "-3P")), substr(mat_mirna_goa$mirbase_id,1,nchar(mat_mirna_goa$mirbase_id)-3), mat_mirna_goa$mirbase_id)
mat_mirna_goa$mirbase_id <- ifelse(
(endsWith(mat_mirna_goa$mirbase_id, "-5p")) | (endsWith(mat_mirna_goa$mirbase_id, "-5P")), substr(mat_mirna_goa$mirbase_id,1,nchar(mat_mirna_goa$mirbase_id)-3), mat_mirna_goa$mirbase_id)
mat_mirna_goa$mirbase_id <- gsub("(?<=MIR)[-]", "", mat_mirna_goa$mirbase_id, perl=TRUE)
sum((unique(edge_df$Gene) %in% unique(mat_mirna_goa$mirbase_id)) | (substr(unique(edge_df$Gene), 1, nchar(unique(edge_df$Gene)) -2)) %in% unique(mat_mirna_goa$mirbase_id))
length(unique(edge_df$Gene))
unique(edge_df$Gene[!(unique(edge_df$Gene) %in% unique(mat_mirna_goa$mirbase_id)) & !((substr(unique(edge_df$Gene), 1, nchar(unique(edge_df$Gene)) -2)) %in% unique(mat_mirna_goa$mirbase_id))])
sum((unique(edge_df$Gene) %in% unique(mat_mirna_goa$mirbase_id)) | (substr(unique(edge_df$Gene), 1, nchar(unique(edge_df$Gene)) -2)) %in% unique(mat_mirna_goa$mirbase_id))
length(unique(edge_df$Gene))
unique(edge_df$Gene[!(unique(edge_df$Gene) %in% unique(mat_mirna_goa$mirbase_id)) & !((substr(unique(edge_df$Gene), 1, nchar(unique(edge_df$Gene)) -2)) %in% unique(mat_mirna_goa$mirbase_id))])
library(dplyr)
analysis_df <- edge_df |>
group_by(Gene) |>
summarize(mean_abs_z_score = mean(abs(z_score_combined)),
mean_z_score = mean(z_score_combined),
max_z_score = max(z_score_combined),
min_z_score = min(z_score_combined),
median_z_score = median(z_score_combined))
analysis_df
filtered_analysis_df <- analysis_df |>
filter((Gene %in% mat_mirna_goa$mirbase_id) | (grepl("-[0-9]+$", Gene) & (substr(Gene, 1, nchar(Gene) - 2) %in% mat_mirna_goa$mirbase_id)))
filtered_analysis_df
go_groups <- mat_mirna_goa |>
group_by(GO_Term) |>
summarize(mirlist = list(mirbase_id))
# Clean up go_groups so that it contains -[int] when MIRs have that
filtered_analysis_df <- filtered_analysis_df %>%
mutate(gene_base = sub("-\\d+$", "", Gene))
genes_map <- filtered_analysis_df %>%
group_by(gene_base) %>%
summarise(full_names = list(Gene))
genes_map_list <- setNames(genes_map$full_names, genes_map$gene_base)
pathways <- lapply(go_groups$mirlist, function(set) {
unique(unlist(
lapply(set, function(g) if (!is.null(genes_map_list[[g]])) genes_map_list[[g]] else character())
))
})
names(pathways) <- go_groups$GO_Term
stats_mean_zscore <- setNames(filtered_analysis_df$mean_z_score, filtered_analysis_df$Gene)
stats_mean_abs_zscore <- setNames(filtered_analysis_df$mean_abs_z_score, filtered_analysis_df$Gene)
stats_median_zscore <- setNames(filtered_analysis_df$mean_z_score, filtered_analysis_df$Gene)
pathways_with_edges <- lapply(pathways, function(genes) {
unique(unlist(gene_to_edges[genes]))
})
# Clean up go_groups so that it contains -[int] when MIRs have that
filtered_analysis_df <- filtered_analysis_df %>%
mutate(gene_base = sub("-\\d+$", "", Gene))
genes_map <- filtered_analysis_df %>%
group_by(gene_base) %>%
summarise(full_names = list(Gene))
genes_map_list <- setNames(genes_map$full_names, genes_map$gene_base)
pathways <- lapply(go_groups$mirlist, function(set) {
unique(unlist(
lapply(set, function(g) if (!is.null(genes_map_list[[g]])) genes_map_list[[g]] else character())
))
})
names(pathways) <- go_groups$GO_Term
stats_mean_zscore <- setNames(filtered_analysis_df$mean_z_score, filtered_analysis_df$Gene)
stats_mean_abs_zscore <- setNames(filtered_analysis_df$mean_abs_z_score, filtered_analysis_df$Gene)
stats_median_zscore <- setNames(filtered_analysis_df$mean_z_score, filtered_analysis_df$Gene)
gene_to_edges <- split(edge_df$Edge, edge_df$Gene)
# Clean up go_groups so that it contains -[int] when MIRs have that
filtered_analysis_df <- filtered_analysis_df %>%
mutate(gene_base = sub("-\\d+$", "", Gene))
genes_map <- filtered_analysis_df %>%
group_by(gene_base) %>%
summarise(full_names = list(Gene))
genes_map_list <- setNames(genes_map$full_names, genes_map$gene_base)
pathways <- lapply(go_groups$mirlist, function(set) {
unique(unlist(
lapply(set, function(g) if (!is.null(genes_map_list[[g]])) genes_map_list[[g]] else character())
))
})
names(pathways) <- go_groups$GO_Term
stats_mean_zscore <- setNames(filtered_analysis_df$mean_z_score, filtered_analysis_df$Gene)
stats_mean_abs_zscore <- setNames(filtered_analysis_df$mean_abs_z_score, filtered_analysis_df$Gene)
stats_median_zscore <- setNames(filtered_analysis_df$mean_z_score, filtered_analysis_df$Gene)
gene_to_edges <- split(edge_df$edge, edge_df$Gene)
pathways_with_edges <- lapply(pathways, function(genes) {
unique(unlist(gene_to_edges[genes]))
})
stats_raw_zscore <- setNames(edge_df$z_score_combined, edge_df$edge)
library(fgsea)
gsea_results_raw_zscore <- fgsea(pathways_with_edges, stats_raw_zscore)
View(gsea_results_raw_zscore)
saveRDS(gsea_results_raw_zscore, "../data/gsea_results_raw_zscore.rds")
saveRDS(gsea_results_raw_zscore, "/Users/ava/Documents/Glass_Lab/data/gsea_results_raw_zscore.rds")
write.csv(gsea_results_raw_zscore, "/Users/ava/Documents/Glass_Lab/data/gsea_results_raw_zscore.csv")
dput(gsea_results_raw_zscore, "/Users/ava/Documents/Glass_Lab/data/gsea_results_raw_zscore.txt")
gsea_results_raw_zscore$leadingEdge[3]
stats_raw_zscore
963/3
stats_raw_zscore
View(pathways_with_edges)
pathways_with_edges[["GO:1900119"]]
pathways_with_edges[["GO:0050709"]]
gsea_results_raw_zscore
gsea_results_mean_zscore
gsea_results_mean_zscore
gsea_results_mean_zscore <- fgsea(pathways, stats_mean_zscore, minSize=3)
gsea_results_mean_zscore
gsea_results_raw_zscore
pathways_with_edges
length(pathways_with_edges)
length(pathways)
gsea_results_mean_zscore <- fgsea(pathways, stats_mean_zscore)
gsea_results_mean_zscore
gsea_results_raw_zscore
cor(gsea_results_raw_zscore$NES, gsea_results_mean_zscore$NES)
cor(gsea_results_raw_zscore$pval, gsea_results_mean_zscore$pva.)
cor(gsea_results_raw_zscore$pval, gsea_results_mean_zscore$pval)
cor(gsea_results_raw_zscore$padj, gsea_results_mean_zscore$padj)
cor(gsea_results_raw_zscore$size, gsea_results_mean_zscore$size)
gsea_results_raw_zscore
gsea_results_raw_zscore <- readRDS("/Users/ava/Documents/Glass_Lab/data/gsea_results_raw_zscore.rds")
gsea_results_raw_zscore
readLines("/Users/ava/Documents/Glass_Lab/data/goa.obo")
readLines("/Users/ava/Documents/Glass_Lab/data/goa.obo.txt")
View(pathways)
obo_lines <- readLines("/Users/ava/Documents/Glass_Lab/data/goa.obo.txt")
go_parents <- list()
current_go <- NULL
for (line in obo_lines) {
line <- trimws(line)
if (line == "[Term]") {
current_go <- NULL  # Reset for the next term
} else if (startsWith(line, "id: GO:")) {
current_go <- sub("id: ", "", line)
if (!is.null(current_go)) go_parents[[current_go]] <- character()
} else if (startsWith(line, "is_a: GO:")) {
parent <- sub("is_a: (GO:\\d+).*", "\\1", line)
go_parents[[current_go]] <- c(go_parents[[current_go]], parent)
}
}
get_ancestors <- function(go_id, go_parents, acc = character()) {
parents <- go_parents[[go_id]]
if (is.null(parents) || length(parents) == 0) return(acc)
for (p in parents) {
if (!(p %in% acc)) {
acc <- c(acc, p)
acc <- get_ancestors(p, go_parents, acc)
}
}
return(unique(acc))
}
pathways_propagated <- pathways
for (go_id in names(pathways)) {
ancestors <- get_ancestors(go_id, go_parents)
for (anc_id in ancestors) {
# Add genes to ancestor GO term in the list
if (! anc_id %in% names(pathways_propagated)) {
pathways_propagated[[anc_id]] <- character()
}
pathways_propagated[[anc_id]] <- unique(c(pathways_propagated[[anc_id]], pathways[[go_id]]))
}
}
pathways_propogated
pathways_propagated
View(pathways_propagated)
View(pathways)
gene_to_edges <- split(edge_df$edge, edge_df$Gene)
pathways_with_edges <- lapply(pathways, function(genes) {
unique(unlist(gene_to_edges[genes]))
})
pathways_propogated_with_edges <- lapply(pathways_propagated, function(genes) {
unique(unlist(gene_to_edges[genes]))
})
View(pathways_propogated_with_edges)
View(go_parents)
View(gsea_results_raw_zscore)
cor(gsea_results_raw_zscore$pval, gsea_results_mean_zscore$pval)
cor(gsea_results_raw_zscore$NES, gsea_results_mean_zscore$NES)
library(fgsea)
gsea_results_mean_zscore <- fgsea(pathways, stats_mean_zscore)
gsea_results_abs_mean_zscore <- fgsea(pathways, stats_mean_abs_zscore, minSize=3)
gsea_results_median_zscore <- fgsea(pathways, stats_median_zscore, minSize=3)
cor(gsea_results_abs_mean_zscore$NES, gsea_results_mean_zscore$NES)
gsea_results_abs_mean_zscore
View(gsea_results_mean_zscore)
View(gsea_results_median_zscore)
library(fgsea)
gsea_results_mean_zscore <- fgsea(pathways, stats_mean_zscore, minSize=3)
gsea_results_abs_mean_zscore <- fgsea(pathways, stats_mean_abs_zscore, minSize=3)
gsea_results_median_zscore <- fgsea(pathways, stats_median_zscore, minSize=3)
cor(gsea_results_raw_zscore$NES, gsea_results_mean_zscore$NES)
cor(gsea_results_abs_mean_zscore$NES, gsea_results_mean_zscore$NES)
cor(gsea_results_abs_mean_zscore$pvalue, gsea_results_mean_zscore$pvale)
cor(gsea_results_abs_mean_zscore$pvalue, gsea_results_mean_zscore$pvalue)
cor(gsea_results_abs_mean_zscore$pval, gsea_results_mean_zscore$pval)
cor(gsea_results_median_zscore$NES, gsea_results_mean_zscore$NES)
cor(gsea_results_median_zscore$pval, gsea_results_mean_zscore$pval)
View(gsea_results_abs_mean_zscore)
cor(gsea_results_median_zscore$NES, gsea_results_mean_zscore$NES)
cor(gsea_results_abs_mean_zscore$pval, gsea_results_mean_zscore$pval)
View(gsea_results_raw_zscore)
View(mat_mirna_goa)
table(mat_mirna_goa$Relationship)
unique(mat_mirna_goa$Relationship)
print(unique(mat_mirna_goa$Relationship))
length(unique(mat_mirna_goa$Gene_Name))
unique(mat_mirna_goa$Gene_Name)
arrange(unique(mat_mirna_goa$Gene_Name))
sort(unique(mat_mirna_goa$Gene_Name))
print
help
if
install.packages(c("foreach", "doParallel"))
detectCores()
library(foreach)
library(doParallel)
detectCores()
?makeCluster
detectCores
pixel_position <- arrayInd(which.max(cols), c(28, 28))
cols <- colMeans(mnist$train$images)
set.seed(2025)
## your code here
x <- matrix(rnorm(1000),100)
## your code here
dim(x)
nrow(x)
ncol(x)
## your code here
x <- x + c(1:100)
## your code here
x <- sweep(x, 2, 1:10, "+")
## your code here
rowMeans(x)
## your code here
colMeans(x)
library(dslabs)
mnist <- read_mnist()
dim(mnist$train$images)
means <- rowMeans(mnist$train$images >= 50 & mnist$train$images <=205)
number <- mnist$train$labels
boxplot(means ~ number)
## your code here
a <- matrix(c(1,2,1,2,1,-4,-2,-5,1),3)
b <- c(-15,-21,18)
solve(a,b)
solve(a)
a %*% solve(a) %*% a
a
## your code here
q <- matrix(1/nrow(x), 1,nrow)
mat_mirna_goa <- read.csv("../data/mat_mirna_goa.csv")
edge_df <- read.csv("../data/all_merged_for_analysis.csv")
mat_mirna_goa$mirbase_id <- mat_mirna_goa$Gene_Name
# Preprocess mat_mirna_goa to match format of edge_df
mat_mirna_goa$mirbase_id <- substr(toupper(mat_mirna_goa$mirbase_id), 5, nchar(mat_mirna_goa$mirbase_id))
mat_mirna_goa$mirbase_id <- ifelse(
(endsWith(mat_mirna_goa$mirbase_id, "-3p")) | (endsWith(mat_mirna_goa$mirbase_id, "-3P")), substr(mat_mirna_goa$mirbase_id,1,nchar(mat_mirna_goa$mirbase_id)-3), mat_mirna_goa$mirbase_id)
mat_mirna_goa$mirbase_id <- ifelse(
(endsWith(mat_mirna_goa$mirbase_id, "-5p")) | (endsWith(mat_mirna_goa$mirbase_id, "-5P")), substr(mat_mirna_goa$mirbase_id,1,nchar(mat_mirna_goa$mirbase_id)-3), mat_mirna_goa$mirbase_id)
mat_mirna_goa$mirbase_id <- gsub("(?<=MIR)[-]", "", mat_mirna_goa$mirbase_id, perl=TRUE)
# Check which miRNAs aren't in there
sum((unique(edge_df$Gene) %in% unique(mat_mirna_goa$mirbase_id)) | (substr(unique(edge_df$Gene), 1, nchar(unique(edge_df$Gene)) -2)) %in% unique(mat_mirna_goa$mirbase_id))
length(unique(edge_df$Gene))
unique(edge_df$Gene[!(unique(edge_df$Gene) %in% unique(mat_mirna_goa$mirbase_id)) & !((substr(unique(edge_df$Gene), 1, nchar(unique(edge_df$Gene)) -2)) %in% unique(mat_mirna_goa$mirbase_id))])
library(dplyr)
analysis_df <- edge_df |>
group_by(Gene) |>
summarize(mean_abs_z_score = mean(abs(z_score_combined)),
mean_z_score = mean(z_score_combined),
max_z_score = max(z_score_combined),
min_z_score = min(z_score_combined),
median_z_score = median(z_score_combined))
analysis_df
filtered_analysis_df <- analysis_df |>
filter((Gene %in% mat_mirna_goa$mirbase_id) | (grepl("-[0-9]+$", Gene) & (substr(Gene, 1, nchar(Gene) - 2) %in% mat_mirna_goa$mirbase_id)))
go_groups <- mat_mirna_goa |>
group_by(GO_Term) |>
summarize(mirlist = list(mirbase_id))
# Clean up go_groups so that it contains -[int] when MIRs have that
filtered_analysis_df <- filtered_analysis_df %>%
mutate(gene_base = sub("-\\d+$", "", Gene))
genes_map <- filtered_analysis_df %>%
group_by(gene_base) %>%
summarise(full_names = list(Gene))
genes_map_list <- setNames(genes_map$full_names, genes_map$gene_base)
pathways <- lapply(go_groups$mirlist, function(set) {
unique(unlist(
lapply(set, function(g) if (!is.null(genes_map_list[[g]])) genes_map_list[[g]] else character())
))
})
names(pathways) <- go_groups$GO_Term
stats_mean_zscore <- setNames(filtered_analysis_df$mean_z_score, filtered_analysis_df$Gene)
stats_mean_abs_zscore <- setNames(filtered_analysis_df$mean_abs_z_score, filtered_analysis_df$Gene)
stats_median_zscore <- setNames(filtered_analysis_df$mean_z_score, filtered_analysis_df$Gene)
gene_to_edges <- split(edge_df$edge, edge_df$Gene)
pathways_with_edges <- lapply(pathways, function(genes) {
unique(unlist(gene_to_edges[genes]))
})
stats_raw_zscore <- setNames(edge_df$z_score_combined, edge_df$edge)
library(fgsea)
gsea_results_mean_zscore <- fgsea(pathways, stats_mean_zscore, minSize=3)
obo_lines <- readLines("/Users/ava/Documents/Glass_Lab/data/goa.obo.txt")
go_parents <- list()
current_go <- NULL
for (line in obo_lines) {
line <- trimws(line)
if (line == "[Term]") {
current_go <- NULL  # Reset for the next term
} else if (startsWith(line, "id: GO:")) {
current_go <- sub("id: ", "", line)
if (!is.null(current_go)) go_parents[[current_go]] <- character()
} else if (startsWith(line, "is_a: GO:")) {
parent <- sub("is_a: (GO:\\d+).*", "\\1", line)
go_parents[[current_go]] <- c(go_parents[[current_go]], parent)
}
}
get_ancestors <- function(go_id, go_parents, acc = character()) {
parents <- go_parents[[go_id]]
if (is.null(parents) || length(parents) == 0) return(acc)
for (p in parents) {
if (!(p %in% acc)) {
acc <- c(acc, p)
acc <- get_ancestors(p, go_parents, acc)
}
}
return(unique(acc))
}
pathways_propagated <- pathways
for (go_id in names(pathways)) {
ancestors <- get_ancestors(go_id, go_parents)
for (anc_id in ancestors) {
if (! anc_id %in% names(pathways_propagated)) {
pathways_propagated[[anc_id]] <- character()
}
pathways_propagated[[anc_id]] <- unique(c(pathways_propagated[[anc_id]], pathways[[go_id]]))
}
}
pathways_propogated_with_edges <- lapply(pathways_propagated, function(genes) {
unique(unlist(gene_to_edges[genes]))
})
gsea_results_prop_pathways <- fgsea(pathways_propogated_with_edges, stats_raw_zscore)
View(gsea_results_prop_pathways)
saveRDS(gsea_results_prop_pathways, "/Users/ava/Documents/Glass_Lab/data/gsea_results_prop_pathways.rds
")
44298/963
sum(gsea_results_prop_pathways$padj < 0.05)
obo_lines <- readLines("/Users/ava/Documents/Glass_Lab/data/goa.obo.txt")
go_parents <- list()
current_go <- NULL
for (line in obo_lines) {
line <- trimws(line)
if (line == "[Term]") {
current_go <- NULL  # Reset for the next term
} else if (startsWith(line, "id: GO:")) {
current_go <- sub("id: ", "", line)
if (!is.null(current_go)) go_parents[[current_go]] <- character()
} else if (startsWith(line, "is_a: GO:")) {
parent <- sub("is_a: (GO:\\d+).*", "\\1", line)
go_parents[[current_go]] <- c(go_parents[[current_go]], parent)
}
}
get_ancestors <- function(go_id, go_parents, acc = character()) {
parents <- go_parents[[go_id]]
if (is.null(parents) || length(parents) == 0) return(acc)
for (p in parents) {
if (!(p %in% acc)) {
acc <- c(acc, p)
acc <- get_ancestors(p, go_parents, acc)
}
}
return(unique(acc))
}
pathways_propagated <- pathways
mat_mirna_goa <- read.csv("../data/mat_mirna_goa.csv")
edge_df <- read.csv("../data/all_merged_for_analysis.csv")
mat_mirna_goa$mirbase_id <- mat_mirna_goa$Gene_Name
# Preprocess mat_mirna_goa to match format of edge_df
mat_mirna_goa$mirbase_id <- substr(toupper(mat_mirna_goa$mirbase_id), 5, nchar(mat_mirna_goa$mirbase_id))
mat_mirna_goa$mirbase_id <- ifelse(
(endsWith(mat_mirna_goa$mirbase_id, "-3p")) | (endsWith(mat_mirna_goa$mirbase_id, "-3P")), substr(mat_mirna_goa$mirbase_id,1,nchar(mat_mirna_goa$mirbase_id)-3), mat_mirna_goa$mirbase_id)
mat_mirna_goa$mirbase_id <- ifelse(
(endsWith(mat_mirna_goa$mirbase_id, "-5p")) | (endsWith(mat_mirna_goa$mirbase_id, "-5P")), substr(mat_mirna_goa$mirbase_id,1,nchar(mat_mirna_goa$mirbase_id)-3), mat_mirna_goa$mirbase_id)
mat_mirna_goa$mirbase_id <- gsub("(?<=MIR)[-]", "", mat_mirna_goa$mirbase_id, perl=TRUE)
# Check which miRNAs aren't in there
sum((unique(edge_df$Gene) %in% unique(mat_mirna_goa$mirbase_id)) | (substr(unique(edge_df$Gene), 1, nchar(unique(edge_df$Gene)) -2)) %in% unique(mat_mirna_goa$mirbase_id))
length(unique(edge_df$Gene))
unique(edge_df$Gene[!(unique(edge_df$Gene) %in% unique(mat_mirna_goa$mirbase_id)) & !((substr(unique(edge_df$Gene), 1, nchar(unique(edge_df$Gene)) -2)) %in% unique(mat_mirna_goa$mirbase_id))])
library(dplyr)
analysis_df <- edge_df |>
group_by(Gene) |>
summarize(mean_abs_z_score = mean(abs(z_score_combined)),
mean_z_score = mean(z_score_combined),
max_z_score = max(z_score_combined),
min_z_score = min(z_score_combined),
median_z_score = median(z_score_combined))
analysis_df
filtered_analysis_df <- analysis_df |>
filter((Gene %in% mat_mirna_goa$mirbase_id) | (grepl("-[0-9]+$", Gene) & (substr(Gene, 1, nchar(Gene) - 2) %in% mat_mirna_goa$mirbase_id)))
go_groups <- mat_mirna_goa |>
group_by(GO_Term) |>
summarize(mirlist = list(mirbase_id))
# Clean up go_groups so that it contains -[int] when MIRs have that
filtered_analysis_df <- filtered_analysis_df %>%
mutate(gene_base = sub("-\\d+$", "", Gene))
genes_map <- filtered_analysis_df %>%
group_by(gene_base) %>%
summarise(full_names = list(Gene))
genes_map_list <- setNames(genes_map$full_names, genes_map$gene_base)
pathways <- lapply(go_groups$mirlist, function(set) {
unique(unlist(
lapply(set, function(g) if (!is.null(genes_map_list[[g]])) genes_map_list[[g]] else character())
))
})
names(pathways) <- go_groups$GO_Term
stats_mean_zscore <- setNames(filtered_analysis_df$mean_z_score, filtered_analysis_df$Gene)
stats_mean_abs_zscore <- setNames(filtered_analysis_df$mean_abs_z_score, filtered_analysis_df$Gene)
stats_median_zscore <- setNames(filtered_analysis_df$mean_z_score, filtered_analysis_df$Gene)
gene_to_edges <- split(edge_df$edge, edge_df$Gene)
pathways_with_edges <- lapply(pathways, function(genes) {
unique(unlist(gene_to_edges[genes]))
})
stats_raw_zscore <- setNames(edge_df$z_score_combined, edge_df$edge)
library(fgsea)
gsea_results_mean_zscore <- fgsea(pathways, stats_mean_zscore, minSize=3)
obo_lines <- readLines("/Users/ava/Documents/Glass_Lab/data/goa.obo.txt")
go_parents <- list()
current_go <- NULL
for (line in obo_lines) {
line <- trimws(line)
if (line == "[Term]") {
current_go <- NULL  # Reset for the next term
} else if (startsWith(line, "id: GO:")) {
current_go <- sub("id: ", "", line)
if (!is.null(current_go)) go_parents[[current_go]] <- character()
} else if (startsWith(line, "is_a: GO:")) {
parent <- sub("is_a: (GO:\\d+).*", "\\1", line)
go_parents[[current_go]] <- c(go_parents[[current_go]], parent)
}
}
get_ancestors <- function(go_id, go_parents, acc = character()) {
parents <- go_parents[[go_id]]
if (is.null(parents) || length(parents) == 0) return(acc)
for (p in parents) {
if (!(p %in% acc)) {
acc <- c(acc, p)
acc <- get_ancestors(p, go_parents, acc)
}
}
return(unique(acc))
}
pathways_propagated <- pathways
for (go_id in names(pathways)) {
ancestors <- get_ancestors(go_id, go_parents)
for (anc_id in ancestors) {
if (! anc_id %in% names(pathways_propagated)) {
pathways_propagated[[anc_id]] <- character()
}
pathways_propagated[[anc_id]] <- unique(c(pathways_propagated[[anc_id]], pathways[[go_id]]))
}
}
View(pathways_propagated)
View(pathways_with_edges)
View(pathways)
View(pathways_propagated)
pathways
pathways_propagated
pathways[1]
pathways_propagated[1]
pathways_propagated[1:10]
pathways[1:10]
pathways[15]
pathways_propagated[15]
View(pathways_with_edges)
View(pathways)
stats_raw_zscore
arrange(stats_raw_zscore)
View(analysis_df)
stats_mean_abs_zscore
names(stats_mean_zscore)
unlist(names(stats_mean_zscore))
writeLines(names(stats_mean_zscore), "/Users/ava/Documents/Glass_Lab/data/stats_mean_zscore.txt")
writeLines(paste0("mir-hsa-",names(stats_mean_zscore)), "/Users/ava/Documents/Glass_Lab/data/stats_mean_zscore.txt")
writeLines(paste0("hsa-mir-",names(stats_mean_zscore)), "/Users/ava/Documents/Glass_Lab/data/stats_mean_zscore.txt")
writeLines(paste0("hsa-mir-",to_lower(names(stats_mean_zscore))), "/Users/ava/Documents/Glass_Lab/data/stats_mean_zscore.txt")
?lower
??lower
??lowercase
??lowercase
writeLines(paste0("hsa-mir-",tolower(names(stats_mean_zscore))), "/Users/ava/Documents/Glass_Lab/data/stats_mean_zscore.txt")
writeLines(names(stats_mean_zscore), "/Users/ava/Documents/Glass_Lab/data/stats_mean_zscore.txt")
substr(names(stats_mean_zscore), 4, nchar(names(stats_mean_zscore)))
writeLines(paste0("hsa-mir-",substr(names(stats_mean_zscore), 4, nchar(names(stats_mean_zscore)))), "/Users/ava/Documents/Glass_Lab/data/stats_mean_zscore.txt")
writeLines(paste0("hsa-miR-",substr(names(stats_mean_zscore), 4, nchar(names(stats_mean_zscore)))), "/Users/ava/Documents/Glass_Lab/data/stats_mean_zscore.txt")
writeLines(paste0("hsa-mir-",tolower(substr(names(stats_mean_zscore), 4, nchar(names(stats_mean_zscore))))), "/Users/ava/Documents/Glass_Lab/data/stats_mean_zscore.txt")
edge_df <- read.csv("../data/all_merged_for_analysis.csv")
targets <- read.csv("../data/miRDB_v6.0_prediction_result.txt",sep="")
View(targets)
View(targets)
